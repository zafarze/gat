<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    {% load static %}
    <title>{{ page_title }}</title>
    
    {# –®—Ä–∏—Ñ—Ç—ã –¥–ª—è –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–æ–≥–æ —Å—Ç–∏–ª—è #}
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700;900&display=swap" rel="stylesheet">
    
    {# –¢–≤–æ–∏ —Å—Ç–∏–ª–∏ #}
    <link rel="stylesheet" href="{% static 'css/booklet.css' %}">
    
    {# –°—Ç–∏–ª–∏ –¥–ª—è Cropper (–æ–±—Ä–µ–∑–∫–∞ —Ñ–æ—Ç–æ) #}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    
    {# HTMX –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –ª–µ—Ç—É #}
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
</head>
<body hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>
    
    {# --- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö) --- #}
    <div id="save-status-indicator">–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã</div>

    {# --- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ–±—Ä–µ–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π --- #}
    <div id="cropper-modal">
        <div class="cropper-modal-content">
            <div class="img-container"><img id="image-to-crop" src=""></div>
            <div class="modal-actions">
                <button id="btn-cancel-crop" class="cropper-btn btn-cancel">–û—Ç–º–µ–Ω–∞</button>
                <button id="btn-save-crop" class="cropper-btn btn-save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    {# --- –ò–°–•–û–î–ù–´–ô –ö–û–ù–¢–ï–ô–ù–ï–† (–°–∫—Ä—ã—Ç, –æ—Ç—Å—é–¥–∞ JS –±–µ—Ä–µ—Ç –≤–æ–ø—Ä–æ—Å—ã) --- #}
    <div id="source-container" style="display: none;">
    {% for question in all_questions %}
        
        {% ifchanged question.subject.id %}
            {# –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–µ–¥–º–µ—Ç–∞ #}
            <div class="content-element subject-header-container" 
                 data-type="title" 
                 data-subject-id="{{ question.subject.id }}">
                 
                <h2 class="subject-title" {% if not forloop.first %}style="margin-top: 25px;"{% endif %}>
                    {{ question.subject.name }}
                </h2>
            </div>
        {% endifchanged %}

        {# –°–∞–º –≤–æ–ø—Ä–æ—Å (–≤–Ω—É—Ç—Ä–∏ partials —É–∂–µ –µ—Å—Ç—å –Ω—É–∂–Ω—ã–µ data-–∞—Ç—Ä–∏–±—É—Ç—ã) #}
        <div class="content-element question-item" 
             data-id="{{ question.id }}" 
             data-type="question" 
             data-subject-id="{{ question.subject.id }}">
            {% include "booklet/partials/_booklet_question.html" with question=question %}
        </div>

    {% endfor %}
    </div>

    {# --- –°–Æ–î–ê JS –ë–£–î–ï–¢ –ì–ï–ù–ï–†–ò–†–û–í–ê–¢–¨ –°–¢–†–ê–ù–ò–¶–´ –ê4 --- #}
    <div id="pages-root"></div>

    {# --- –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø (TOOLBAR) --- #}
    <div class="toolbar">
        <div class="toolbar-content">
            <button onclick="toggleAnswers()" class="tool-btn btn-answers">
                üëÅÔ∏è –û—Ç–≤–µ—Ç—ã
            </button>
            
            <button onclick="toggleGrayscale()" class="tool-btn btn-bw">
                ‚ö´‚ö™ –ß/–ë –≤–∏–¥
            </button>

            <a href="{% url 'core:gat_test_download_pdf' test.pk %}" class="tool-btn btn-pdf" style="text-decoration: none; display: inline-flex; align-items: center;">
                üìÑ –°–∫–∞—á–∞—Ç—å PDF
            </a>

            <a href="{% url 'core:gat_test_export_word' test.pk %}" class="tool-btn btn-pdf" style="background-color: #2b579a; text-decoration: none; display: inline-flex; align-items: center;">
                üìù –°–∫–∞—á–∞—Ç—å Word
            </a>

            <a href="{% url 'core:gat_test_list' %}" class="tool-btn btn-back" style="text-decoration: none; display: inline-flex; align-items: center;">
                ‚¨ÖÔ∏è –ù–∞–∑–∞–¥
            </a>
        </div>
    </div>

    {# --- –®–ê–ë–õ–û–ù –®–ê–ü–ö–ò –°–¢–†–ê–ù–ò–¶–´ --- #}
    <template id="header-template">
        <div class="header-grid">
            <div class="header-left">{{ header_left }}</div>
            <div class="header-center">{{ header_center }}</div>
            <div class="header-right">{{ header_right }}</div>
        </div>
    </template>

    {# --- –®–ê–ë–õ–û–ù –ü–û–î–í–ê–õ–ê –°–¢–†–ê–ù–ò–¶–´ --- #}
    <template id="footer-template">
        <div class="footer-content">
            <span class="page-number">1</span>
        </div>
    </template>

    {# --- –°–ö–†–ò–ü–¢–´ --- #}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    
    {# –î–∞–Ω–Ω—ã–µ –¥–ª—è JS #}
    <script id="booklet-data" type="application/json">
    {
        "saveUrl": "{% url 'core:gat_test_save_order' test.pk %}",
        "saveOptionOrderUrl": "{% url 'core:bank_question_save_option_order' 0 %}",
        "updateImageUrl": "{% url 'core:bank_question_update_image' 0 %}",
        "csrfToken": "{{ csrf_token }}"
    }
    </script>
    
    {# –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ #}
    <script src="{% static 'js/booklet.js' %}" defer></script>
</body>
</html>