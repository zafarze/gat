<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    {% load static %}
    
    <style>
        @page {
            size: A4;
            margin: 10mm 15mm;
            @bottom-center {
                content: counter(page);
                font-family: 'Times New Roman', serif;
                font-size: 12px;
                border-top: 1px solid black;
                width: 100%;
                padding-top: 5px;
            }
            @bottom-left { content: ""; } @bottom-right { content: ""; }
            @top-left { content: ""; } @top-right { content: ""; } @top-center { content: ""; }
        }

        body {
            font-family: 'Times New Roman', serif;
            font-size: 13px; /* –ß—É—Ç—å —É–º–µ–Ω—å—à–∏–ª —à—Ä–∏—Ñ—Ç –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏ */
            line-height: 1.2;
            margin: 0; padding: 0;
        }
        
        .columns-container {
            column-count: 2;
            column-gap: 8mm; /* –ß—É—Ç—å —É–º–µ–Ω—å—à–∏–ª –∑–∞–∑–æ—Ä */
            column-rule: 1px solid black;
        }

        .header-grid {
            display: table; width: 100%;
            border-bottom: 4px double #999;
            margin-bottom: 15px; padding-bottom: 10px;
        }
        .header-cell { display: table-cell; width: 33%; vertical-align: bottom; }
        .header-center { text-align: center; text-transform: uppercase; font-weight: bold;}
        .header-right { text-align: right; }

        .subject-title {
            text-align: center; text-transform: uppercase; font-weight: bold;
            margin: 10px 0 5px 0;
            break-after: avoid; 
            column-span: all;
            font-size: 14px;
            border-bottom: 1px solid #eee;
        }

        .question-item {
            margin-bottom: 12px;
            break-inside: avoid; /* –í–∞–∂–Ω–æ: –≤–æ–ø—Ä–æ—Å –Ω–µ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç—Å—è */
        }

        /* –ö–∞—Ä—Ç–∏–Ω–∫–∞ –≤–æ–ø—Ä–æ—Å–∞ (–±–æ–ª—å—à–∞—è) */
        .question-image {
            display: block;
            max-width: 95%;
            max-height: 120px;
            margin: 5px auto;
            object-fit: contain;
        }

        /* –ö–∞—Ä—Ç–∏–Ω–∫–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ—Ç–≤–µ—Ç–∞ (–º–∞–ª–µ–Ω—å–∫–∞—è) */
        .option-image {
            display: block;
            max-height: 50px; /* –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É, —á—Ç–æ–±—ã –Ω–µ —Ä–∞–∑–¥—É–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ */
            max-width: 100%;
            margin-top: 3px;
            margin-left: 0;
        }

        ul { list-style: none; padding: 0; margin: 0; }
        li { 
            margin-bottom: 3px; 
            position: relative; 
            padding-left: 5px;
        }
        
        /* –ï—Å–ª–∏ 4 –≤–∞—Ä–∏–∞–Ω—Ç–∞ - —Å–µ—Ç–∫–∞ 2x2 */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2px 10px; /* row-gap column-gap */
        }
        
        .opt-content {
            display: inline-block;
            vertical-align: top;
        }

        .opt-letter { font-weight: bold; margin-right: 3px; float: left; }
    </style>
</head>
<body>

    <div class="header-grid">
        <div class="header-cell">–°–ò–ù–§–ò {{ test.school_class.name }}</div>
        <div class="header-cell header-center">–¢–ï–°–¢–ò –£–ú–£–ú”¢ {{ test.test_number }}</div>
        <div class="header-cell header-right">{{ header_right }}</div>
    </div>

    <div class="columns-container">
        {% for question in all_questions %}
            
            {% ifchanged question.subject.id %}
                {% if not forloop.first %}<div style="height: 10px;"></div>{% endif %}
                <h3 class="subject-title">{{ question.subject.name }}</h3>
            {% endifchanged %}

            <div class="question-item">
                {# –¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞ #}
                <div style="font-weight: bold; margin-bottom: 3px;">
                    {{ forloop.counter }}. {{ question.text|linebreaksbr }}
                </div>

                {# –ö–∞—Ä—Ç–∏–Ω–∫–∞ –≤–æ–ø—Ä–æ—Å–∞ #}
                {% if question.question_image %}
                    <img class="question-image" src="{{ question.question_image.path }}">
                {% endif %}

                {# –°–ø–∏—Å–æ–∫ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ #}
                <ul class="{% if question.fixed_options|length == 4 %}options-grid{% endif %}">
                    {% for option in question.fixed_options %}
                    <li>
                        <span class="opt-letter">
                            {% if forloop.counter == 1 %}A){% elif forloop.counter == 2 %}B){% elif forloop.counter == 3 %}C){% elif forloop.counter == 4 %}D){% else %}E){% endif %}
                        </span>
                        
                        <div class="opt-content">
                            {{ option.text }}
                            
                            {# --- üî• –î–û–ë–ê–í–õ–ï–ù–û: –ö–ê–†–¢–ò–ù–ö–ê –í–ê–†–ò–ê–ù–¢–ê --- #}
                            {% if option.option_image %}
                                {# –ò—Å–ø–æ–ª—å–∑—É–µ–º .path –¥–ª—è WeasyPrint (–ª–æ–∫–∞–ª—å–Ω—ã–π –ø—É—Ç—å), .url –¥–ª—è –≤–µ–±–∞ #}
                                <img class="option-image" src="{{ option.option_image.path }}">
                            {% endif %}
                            {# --- –ö–û–ù–ï–¶ –î–û–ë–ê–í–õ–ï–ù–ò–Ø --- #}
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            </div>

        {% endfor %}
    </div>

</body>
</html>