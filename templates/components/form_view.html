{# D:\New_GAT\templates\components\form_view.html (ОБНОВЛЕННАЯ ВЕРСИЯ) #}

{# --- ГЛАВНОЕ ИЗМЕНЕНИЕ: Умный выбор базового шаблона --- #}
{% extends request.GET.popup|yesno:"components/_base_modal.html,base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="bg-white p-8 rounded-lg shadow-md max-w-2xl">
    <div class="flex justify-between items-center mb-6">
        <div>
            <a href="{% url cancel_url %}" class="text-indigo-600 hover:underline mb-2 inline-block">&larr; Назад к списку</a>
            <h1 class="text-3xl font-bold text-gray-800">{{ title }}</h1>
        </div>
    </div>
    
    <form method="post" novalidate>
        {% include 'components/_form.html' %}
    </form>
</div>

{# Скрипт для перезагрузки родительской страницы после сохранения #}
<script>
    {% if messages %}
        if (window.self !== window.top) {
            window.top.location.reload();
        }
    {% endif %}
</script>
{% endblock %}