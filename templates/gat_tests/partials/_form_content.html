{# D:\GAT\templates\gat_tests\partials\_form_content.html (–ü–û–õ–ù–´–ô –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ö–û–î) #}
{% load widget_tweaks %}

{# –≠—Ç–æ—Ç div —è–≤–ª—è–µ—Ç—Å—è —Ü–µ–ª—å—é –¥–ª—è HTMX –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤–∞–ª–∏–¥–∞—Ü–∏–∏ #}
<div id="modal-form-content" class="h-full">
    <form
        {# –ò—Å–ø–æ–ª—å–∑—É–µ–º request.path –¥–ª—è URL, —Ç.–∫. view –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–æ—Ä–º—É –ø–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É URL #}
        hx-post="{{ request.path }}"
        {# –ü—Ä–∏ –æ—à–∏–±–∫–µ –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —ç—Ç–æ—Ç div #}
        hx-target="#modal-form-content"
        hx-swap="outerHTML"
        {# –ü—Ä–∏ —É—Å–ø–µ—Ö–µ - view –æ—Ç–ø—Ä–∞–≤–∏—Ç HX-Refresh: true #}
        hx-trigger="submit"
        method="post"
        class="flex flex-col h-full bg-white rounded-xl" {# –¢–≤–æ–∏ —Å—Ç–∏–ª–∏ #}
        {# –î–æ–±–∞–≤–ª—è–µ–º HTMX –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞–≤–∏—Å–∏–º—ã—Ö –ø–æ–ª–µ–π –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ #}
        {% if object %}
            hx-get="{% url 'core:load_class_and_subjects_for_gat' %}?school={{ object.school.id }}"
            hx-target="#dependent-fields-container"
            hx-swap="innerHTML"
            hx-trigger="load delay:100ms" {# –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è Alpine #}
        {% endif %}
    >
        {% csrf_token %}

        {# –ó–ê–ì–û–õ–û–í–û–ö (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π) #}
        <div class="p-6 border-b flex justify-between items-center sticky top-0 bg-white z-10">
            <h2 class="text-2xl font-bold text-gray-800">{{ title }}</h2>
            <button type="button" @click="showModal = false" class="text-gray-400 hover:text-gray-600">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
        </div>

        {# –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ (–ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º—ã–π) #}
        <div class="p-8 overflow-y-auto flex-1 space-y-6">

            {% if form.non_field_errors %}
                <div class="p-3 bg-red-100 text-red-700 rounded-lg">
                    {% for error in form.non_field_errors %}<p>{{ error }}</p>{% endfor %}
                </div>
            {% endif %}

            {# --- –ù–æ–≤—ã–µ –ø–æ–ª—è —Ñ–æ—Ä–º—ã GatTestForm --- #}
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">

                {# --- –õ–µ–≤–∞—è –ö–æ–ª–æ–Ω–∫–∞ --- #}
                <div class="space-y-4">
                    <div>
                        <label for="{{ form.name.id_for_label }}" class="modern-label">{{ form.name.label }}</label>
                        {% render_field form.name class+="form-input" %}
                        {% for error in form.name.errors %}<p class="form-error mt-1">{{ error }}</p>{% endfor %}
                    </div>
                    <div>
                        <label for="{{ form.test_number.id_for_label }}" class="modern-label">{{ form.test_number.label }}</label>
                        {% render_field form.test_number class+="form-select" %}
                        {% for error in form.test_number.errors %}<p class="form-error mt-1">{{ error }}</p>{% endfor %}
                    </div>
                     <div>
                        <label for="{{ form.day.id_for_label }}" class="modern-label">{{ form.day.label }}</label>
                        {% render_field form.day class+="form-select" %}
                        {% for error in form.day.errors %}<p class="form-error mt-1">{{ error }}</p>{% endfor %}
                    </div>
                </div>

                {# --- –ü—Ä–∞–≤–∞—è –ö–æ–ª–æ–Ω–∫–∞ --- #}
                <div class="space-y-4">
                     <div>
                        <label for="{{ form.quarter.id_for_label }}" class="modern-label">{{ form.quarter.label }}</label>
                        {% render_field form.quarter class+="form-select" %}
                        {% for error in form.quarter.errors %}<p class="form-error mt-1">{{ error }}</p>{% endfor %}
                    </div>
                    <div>
                        <label for="{{ form.test_date.id_for_label }}" class="modern-label">{{ form.test_date.label }}</label>
                        {% render_field form.test_date type="date" class+="form-input" %} {# –£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ç–∏–ø date #}
                        {% for error in form.test_date.errors %}<p class="form-error mt-1">{{ error }}</p>{% endfor %}
                    </div>
                     <div>
                        <label for="{{ form.school.id_for_label }}" class="modern-label">{{ form.school.label }}</label>
                        {# --- üëá –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –†—É—á–Ω–æ–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø–æ–ª—è form.school üëá --- #}
                        <select
                            name="{{ form.school.name }}"
                            id="{{ form.school.id_for_label }}"
                            class="form-select {{ form.school.field.widget.attrs.class }}" {# –î–æ–±–∞–≤–ª—è–µ–º –±–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã —Ñ–æ—Ä–º—ã #}
                            hx-get="{% url 'core:load_class_and_subjects_for_gat' %}" {# URL —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è Django #}
                            hx-target="#dependent-fields-container"
                            hx-swap="innerHTML"
                            hx-include="[name='school']"
                            hx-trigger="change"
                            hx-indicator="#modal-loading-indicator"
                            {% if form.school.field.required %}required{% endif %}
                        >
                            {# –†–µ–Ω–¥–µ—Ä–∏–º –æ–ø—Ü–∏–∏ (–ø—É—Å—Ç–∞—è + –æ—Å—Ç–∞–ª—å–Ω—ã–µ) #}
                            {% if form.school.field.empty_label %}
                                <option value="">{{ form.school.field.empty_label }}</option>
                            {% endif %}
                            {% for value, text in form.school.field.choices %}
                                <option value="{{ value }}" {% if form.school.value|stringformat:"s" == value|stringformat:"s" %}selected{% endif %}>{{ text }}</option>
                            {% endfor %}
                        </select>
                        {# --- –ö–û–ù–ï–¶ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø --- #}
                        {% for error in form.school.errors %}<p class="form-error mt-1">{{ error }}</p>{% endfor %}
                    </div>
                </div>

                {# --- –ó–∞–≤–∏—Å–∏–º—ã–µ –ø–æ–ª—è (–ö–ª–∞—Å—Å) --- #}
                 <div id="dependent-fields-container" class="md:col-span-2 space-y-4">
                     {# –í–∫–ª—é—á–∞–µ–º —à–∞–±–ª–æ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª—è –ö–õ–ê–°–° #}
                     {% include 'gat_tests/partials/_class_field.html' with form=form %}
                 </div>

                 {# --- –ß–µ–∫–±–æ–∫—Å—ã –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è --- #}
                 <div class="md:col-span-2 border-t pt-4 space-y-3">
                     <div class="relative flex items-start">
                        <div class="flex items-center h-5">
                            {% render_field form.shuffle_questions class+="form-checkbox" %}
                        </div>
                        <div class="ml-3 text-sm">
                            <label for="{{ form.shuffle_questions.id_for_label }}" class="font-medium text-gray-700">{{ form.shuffle_questions.label }}</label>
                            {% if form.shuffle_questions.help_text %}<p class="text-xs text-gray-500">{{ form.shuffle_questions.help_text }}</p>{% endif %}
                        </div>
                     </div>
                     <div class="relative flex items-start">
                        <div class="flex items-center h-5">
                            {% render_field form.shuffle_options class+="form-checkbox" %}
                        </div>
                        <div class="ml-3 text-sm">
                            <label for="{{ form.shuffle_options.id_for_label }}" class="font-medium text-gray-700">{{ form.shuffle_options.label }}</label>
                            {% if form.shuffle_options.help_text %}<p class="text-xs text-gray-500">{{ form.shuffle_options.help_text }}</p>{% endif %}
                         </div>
                     </div>
                 </div>

            </div>

            {# –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è –∑–∞–≤–∏—Å–∏–º—ã—Ö –ø–æ–ª–µ–π #}
            <div id="modal-loading-indicator" class="htmx-indicator text-center text-gray-500 py-4">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª–∞—Å—Å–æ–≤...</div>
        </div>

        {# –§–£–¢–ï–† –° –ö–ù–û–ü–ö–ê–ú–ò (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π) #}
        <div class="p-6 bg-gray-50 border-t flex justify-end items-center gap-4 sticky bottom-0 z-10">
            <button type="button" @click="showModal = false" class="modern-btn secondary">–û—Ç–º–µ–Ω–∞</button>
            <button type="submit" class="modern-btn primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </form>
</div>